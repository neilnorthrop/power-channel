<%= main_frame do %>
  <div class="space-y-4">
    <div class="flex items-center justify-between">
      <h2 class="text-xl font-semibold">Recipes</h2>
      <%= link_to "Back to Content", owner_content_index_path(resource: 'recipes'), class: "text-sm text-blue-600 hover:underline" %>
    </div>
    <div class="rounded border p-3 bg-white mb-2">
      <%= form_with url: owner_recipes_path, method: :get, local: true, class: "flex items-end gap-2" do %>
        <div>
          <label class="block text-xs text-gray-600">Search</label>
          <%= text_field_tag :q, @q, class: 'border rounded px-2 py-1 text-sm', placeholder: 'item name' %>
        </div>
        <div>
          <%= submit_tag 'Apply', class: 'px-2 py-1 rounded bg-gray-800 text-white text-sm' %>
        </div>
      <% end %>
      <% if @q.present? && @recipes.blank? %>
        <div class="mt-2 text-xs text-gray-700">
          No recipes found. <%= link_to 'Create Item', new_owner_content_path(resource: 'items'), class: 'underline' %> to attach a recipe later.
        </div>
      <% end %>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead>
          <tr class="text-left text-gray-500">
            <th class="py-2 pr-4">Item</th>
            <th class="py-2 pr-4">Quantity</th>
            <th class="py-2 pr-4">Components</th>
            <th class="py-2 pr-4">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @recipes.each do |r| %>
            <tr class="border-t">
              <td class="py-2 pr-4">
                <span><%= r.item&.name %></span>
                <% if r.item %>
                  <button class="ml-2 text-xs px-1 py-0.5 rounded border" data-controller="clipboard" data-clipboard-value-value="<%= r.item.name %>" data-action="click->clipboard#copy">Copy</button>
                <% end %>
              </td>
              <td class="py-2 pr-4"><%= r.quantity || 1 %></td>
              <td class="py-2 pr-4">
                <div class="text-xs text-gray-700">
                  <% r.recipe_resources.each do |rr| %>
                    <div>
                      <%= rr.component_type %> - <%= rr.component_type == 'Resource' ? Resource.find_by(id: rr.component_id)&.name : Item.find_by(id: rr.component_id)&.name %> x <%= rr.quantity %>
                      <% if rr.group_key.present? %>(group: <%= rr.group_key %>, <%= rr.logic %>)<% end %>
                    </div>
                  <% end %>
                </div>
              </td>
              <td class="py-2 pr-4">
                <%= link_to 'Edit', edit_owner_recipe_path(r), class: 'text-blue-600 hover:underline' %>
                <span class="text-gray-300">|</span>
                <%= link_to 'Duplicate', duplicate_owner_recipe_path(r), class: 'text-blue-600 hover:underline' %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% end %>
