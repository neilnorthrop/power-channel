<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Aether Forge" %></title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  </head>

  <body class="">
    <div class="container mx-auto p-4 min-h-screen bg-white">
      <div class="flex gap-6">
        <aside id="sidebar" class="hidden md:block w-64 flex-shrink-0">
          <%= render partial: 'game/sidebar' %>
        </aside>

        <!-- backdrop for mobile sidebar -->
        <div id="sidebar-backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40"></div>

        <main class="flex-1">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-3">
              <button id="sidebar-toggle" class="md:hidden inline-flex items-center justify-center p-2 rounded bg-gray-100 hover:bg-gray-200">
                <span class="sr-only">Open sidebar</span>
                â˜°
              </button>

              <%= yield :header %>
            </div>

            <div>
              <!-- right side header actions can be provided by views -->
              <%= yield :header_actions %>
            </div>
          </div>

          <%= yield %>
        </main>
      </div>
    </div>
  </body>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const sidebar = document.getElementById('sidebar');
      const sidebarToggle = document.getElementById('sidebar-toggle');
      const sidebarBackdrop = document.getElementById('sidebar-backdrop');

      const openSidebar = () => {
        if (!sidebar) return;
        sidebar.classList.remove('hidden');
        sidebar.classList.add('fixed', 'inset-y-0', 'left-0', 'z-50', 'w-64', 'bg-white', 'overflow-y-auto');
        sidebarBackdrop.classList.remove('hidden');
      };

      const closeSidebar = () => {
        if (!sidebar) return;
        sidebar.classList.add('hidden');
        sidebar.classList.remove('fixed', 'inset-y-0', 'left-0', 'z-50', 'w-64', 'bg-white', 'overflow-y-auto');
        sidebarBackdrop.classList.add('hidden');
      };

      if (sidebarToggle) sidebarToggle.addEventListener('click', openSidebar);
      if (sidebarBackdrop) sidebarBackdrop.addEventListener('click', closeSidebar);
    });
  </script>
</html>
